import{a as l}from"./chunk-JEDRXPH7.js";import{D as s,Sc as c,Z as a,aa as i,n as r,p as o}from"./chunk-COQ5IRDM.js";var g=class n{constructor(t){this.http=t}apiUrl=l.apiUrl+"auth";login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(o(e=>(e.data?.access_token&&(localStorage.setItem("access_token",e.data.access_token),localStorage.setItem("refresh_token",e.data.refresh_token)),e)))}getMe(){let t=localStorage.getItem("access_token");return t?this.http.get(`${this.apiUrl}/me`,{headers:{Authorization:`Bearer ${t}`}}).pipe(o(e=>{if(e.status_code===200)return localStorage.setItem("user",JSON.stringify(e.data)),e.data;throw new Error(e.message)}),s(e=>(console.error("Error fetching user data:",e),r(()=>e)))):r(()=>new Error("No token found"))}logout(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}isLoggedIn(){return!!localStorage.getItem("access_token")}getAccessToken(){return localStorage.getItem("access_token")}getUserLoggedIn(){let t=localStorage.getItem("user");return t?JSON.parse(t):null}refreshToken(){let t=localStorage.getItem("refresh_token");return t?this.http.post(`${this.apiUrl}/refresh-token`,{refresh_token:t}).pipe(o(e=>(e.data?.access_token&&(localStorage.setItem("access_token",e.data.access_token),e.data.refresh_token&&localStorage.setItem("refresh_token",e.data.refresh_token)),e)),s(e=>(this.logout(),r(()=>e)))):r(()=>new Error("No refresh token found"))}isTokenExpired(){let t=this.getAccessToken();if(!t)return!0;try{let e=JSON.parse(atob(t.split(".")[1])),p=Math.floor(Date.now()/1e3);return e.exp<p}catch{return!0}}static \u0275fac=function(e){return new(e||n)(i(c))};static \u0275prov=a({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
